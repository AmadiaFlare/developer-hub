---
sidebar_position: 5
title: Set Up Flare Entity
description: Provide data for Flare's enshrined FTSO and FDC protocols.
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";
import ThemedImage from "@theme/ThemedImage";
import useBaseUrl from "@docusaurus/useBaseUrl";

This guide provides a sample deployment configuration for infrastructure providers looking to a Flare Entity, consisting of a validator node and a data provider system (FSP) for the Flare network.
The [FSP](/network/fsp) consists of [Flare Time Series Oracle (FTSO)](https://dev.flare.network/ftso/overview) and [Flare Data Connector (FDC)](https://dev.flare.network/fdc/overview).

<ThemedImage
  alt="Data Provider System for FSP"
  sources={{
    light: useBaseUrl("/img/run-node-fsp/fsp_run_node_light.svg"),
    dark: useBaseUrl("/img/run-node-fsp/fsp_run_node_dark.svg"),
  }}
/>

A Flare Entity consists of the following six components:

1. **Flare System Client**: Manages interactions with FTSO smart contracts, including data collection, submission, voter registration, and system tasks.
2. **C-chain Indexer**: Tracks FSP-related blockchain transactions and events, enabling data calculations and action triggers.
3. **FTSO Client**: Provides anchor feed submissions and median data to the System Client.
4. **Fast Updates Client**: Submits block-latency feeds to Fast Updates contracts.
5. **Feed Value Provider**: Retrieves data from exchanges and supplies current feed values (prices).
6. **FDC Client**: Provides FDC protocol voting round data to the System Client.

## Prerequisites

- A machine meeting the [minimum hardware requirements](/run-node/system-requirements).
- A registered [validator node](/run-node/register-validator).
- [Docker Engine](https://docs.docker.com/engine/install/), ensure the Docker data root directory has sufficient disk space. If necessary, configure Docker to use a specific storage location or mount point (refer to Docker's [storage documentation](https://docs.docker.com/engine/storage/)).
- [jq](https://jqlang.github.io/jq/)
- [envsubst](https://www.gnu.org/software/gettext/manual/html_node/envsubst-Invocation.html)

:::tip

To avoid using `sudo` each time you run the `docker` command, add your user to the Docker group after installation:

```bash
sudo usermod -a -G docker $USER
```

Log out and log back in or restart your system for the changes to take effect.

:::

## Rewards

:::warning[Minimal conditions]

After the introduction of minimal conditions in [FIP.10](https://proposals.flare.network/FIP/FIP_10.html#21-new-incentive-structure), a Flare Entity needs to be both **available** and **performant** across all Flare protocols in order to be eligible for rewards.

:::

- **FSP (FTSO, FDC)** reward information is available at [flare-foundation/fsp-rewards](https://github.com/flare-foundation/fsp-rewards/tree/main/flare) and on the [Discourse Forum](https://forum.flare.network/t/fsp-rewards-data) (see XLSX file for historical reward data).\*
- **Staking** reward information is available at [flare-foundation/reward-scripts](https://github.com/flare-foundation/reward-scripts/tree/main/generated-files).\*

\*Updated every reward epoch (3.5 days), with epochs starting on Monday and Thursday.

Currently, claiming rewards needs to be performed [manually](https://github.com/flare-foundation/FTSO-Scaling/blob/main/scripts/rewards/README.md#claiming-rewards). Automated solutions are being worked upon to simplify this process.

## Registration

Before deploying the Flare Entity components, several one-time registration steps must be completed on-chain.
This involves registering operational addresses for the Flare System Provider (FSP), funding them, registering a sortition key for Fast Updates, and linking your validator node ID to your entity's identity.

### Register FSP addresses

You need five specific addresses for FSP operations.
You can register them using an automated script (Testnets only) or manually via contract calls (Mainnet).

<details>
<summary>Method 1: Automated Registration (Testnets Only).</summary>

:::danger

This automated method requires placing private keys in a configuration file.
This significantly increases security risk and is **NOT recommended for mainnet**.
Use this method **only on testnets** (Coston, Coston2) where key security is less critical.
For mainnet, **always use the manual process described below.**

:::

On testnets, you can automate the registration of your five FSP addresses **and** your sortition public key using scripts from the `flare-smart-contracts-v2` repository.

1. Clone and build [flare-smart-contracts-v2](https://github.com/flare-foundation/flare-smart-contracts-v2/):

```bash
git clone https://github.com/flare-foundation/flare-smart-contracts-v2/
cd flare-smart-contracts-v2
yarn
yarn c
```

2. Create an `entities.json` file with the following account addresses and private keys:

```json
[
  {
    "identity": {
      "address": "<address>",
      "privateKey": "<private key hex>"
    },
    "submit": {
      "address": "<address>",
      "privateKey": "<private key hex>"
    },
    "submitSignatures": {
      "address": "<address>",
      "privateKey": "<private key hex>"
    },
    "signingPolicy": {
      "address": "<address>",
      "privateKey": "<private key hex>"
    },
    "delegation": {
      "address": "<address>",
      "privateKey": "<private key hex>"
    },
    "sortitionPrivateKey": "<private key hex>"
  }
]
```

3. Configure your `.env`:

<Tabs groupId="network">
  <TabItem value="coston2" label="Flare Testnet Coston2" default>

    ```text title=".env"
    ENTITIES_FILE_PATH="<path to entities.json>"
    COSTON2_RPC=<non-public Coston2 RPC>
    CHAIN_CONFIG="coston2"
    ```

  </TabItem>
  <TabItem value="songbird" label="Songbird Canary-Network">

    ```text title=".env"
    ENTITIES_FILE_PATH="<path to entities.json>"
    SONGBIRD_RPC=<non-public Songbird RPC>
    CHAIN_CONFIG="songbird"
    ```

  </TabItem>
  <TabItem value="coston" label="Songbird Testnet Coston">

    ```text title=".env"
    ENTITIES_FILE_PATH="<path to entities.json>"
    COSTON_RPC=<non-public Coston RPC>
    CHAIN_CONFIG="coston"
    ```

  </TabItem>
</Tabs>

4. Run the registration tasks:

<Tabs groupId="network">
  <TabItem value="coston2" label="Flare Testnet Coston2" default>

    ```bash
    yarn hardhat --network coston2 register-entities
    yarn hardhat --network coston2 register-public-keys
    ```

  </TabItem>
  <TabItem value="songbird" label="Songbird Canary-Network">

    ```bash
    yarn hardhat --network songbird register-entities
    yarn hardhat --network songbird register-public-keys
    ```

  </TabItem>
  <TabItem value="coston" label="Songbird Testnet Coston">

    ```bash
    yarn hardhat --network coston register-entities
    yarn hardhat --network coston register-public-keys
    ```

  </TabItem>
</Tabs>

If these scripts complete successfully, you have registered both the FSP addresses and the sortition key.
You can proceed directly to [Fund FSP addresses](#fund-fsp-addresses).

</details>

#### Method 2: Manual registration

On mainnet, or if you prefer not to use the automated script on testnets, you must manually register the required FSP addresses by interacting directly with the `EntityManager` smart contract.

1.  Ensure you have generated the following five addresses and **securely stored their private keys**. Understand their roles:

    - `Identity`: The central identity address. **Crucially, keep the private key secure (e.g., cold storage on mainnet).** This address initiates proposals and signs registrations.
    - `Submit`: Used for sending FTSO commit/reveal transactions.
    - `SubmitSignatures`: Used for sending FTSO result signatures (often separate from `Submit` to manage transaction nonces).
    - `SigningPolicy`: Used for signing FTSO data during voting and for reward epoch configurations.
    - `Delegation`: Public address for receiving WNat delegations to increase vote power and collect rewards.

2.  For each address role (`Submit`, `SubmitSignatures`, `SigningPolicy`, `Delegation`), perform the two-step propose-confirm process using the `EntityManager` contract (see [FSP Solidity Reference](/network/fsp/solidity-reference)):

    - **Step A (Propose):** Call the relevant `propose<Role>Address` method from your `Identity` address. Provide the address you want to register for that role as the argument.
    - **Step B (Confirm):** Call the corresponding `confirm<Role>AddressRegistration` method from the address you are actually registering (e.g., call `confirmSubmitAddressRegistration` using the `Submit` address's private key).

    | Role to Register   | Step A: Method Called by `Identity` Address                                                                       | Step B: Method Called by Proposed Address                                                                                                 |
    | :----------------- | :---------------------------------------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------- |
    | `Submit`           | [`proposeSubmitAddress`](/network/fsp/solidity-reference/IEntityManager#proposesubmitaddress)                     | [`confirmSubmitAddressRegistration`](/network/fsp/solidity-reference/IEntityManager#confirmsubmitaddressregistration)                     |
    | `SubmitSignatures` | [`proposeSubmitSignaturesAddress`](/network/fsp/solidity-reference/IEntityManager#proposesubmitsignaturesaddress) | [`confirmSubmitSignaturesAddressRegistration`](/network/fsp/solidity-reference/IEntityManager#confirmsubmitsignaturesaddressregistration) |
    | `SigningPolicy`    | [`proposeSigningPolicyAddress`](/network/fsp/solidity-reference/IEntityManager#proposesigningpolicyaddress)       | [`confirmSigningPolicyAddressRegistration`](/network/fsp/solidity-reference/IEntityManager#confirmsigningpolicyaddressregistration)       |
    | `Delegation`       | [`proposeDelegationAddress`](/network/fsp/solidity-reference/IEntityManager#proposedelegationaddress)             | [`confirmDelegationAddressRegistration`](/network/fsp/solidity-reference/IEntityManager#confirmdelegationaddressregistration)             |

### Fund FSP addresses

All registered FSP addresses (`Identity`, `Submit`, `SubmitSignatures`, `SigningPolicy`, `Delegation`) require funding with the network's native token (FLR, SGB, etc.) to cover transaction gas fees.

Additionally, the `Delegation` address needs sufficient Wrapped Native Token (WNat) balance to achieve voting power in the FTSO protocols.
You can wrap native tokens directly to this address or receive delegations from the community.

- Wrapping Portals:
  - [Development Portal](https://governance.dev.aflabs.org/) (Flare Testnet Coston2, Songbird Testnet Coston)
  - [Flare Portal](https://portal.flare.network) (Flare Mainnet, Songbird Canary-Network)
- The `Delegation` address needs at least **150 WNat** (e.g., WFLR, WC2FLR) for its vote weight to be recognized by the protocols (due to weight normalization).

### Register sortition key

This key pair is used for the FTSOv2 Fast Updates protocol.

1.  Generate a sortition key pair using the [fast-updates/go-client](https://github.com/flare-foundation/fast-updates/pkgs/container/fast-updates%2Fgo-client) image:

    ```bash
    docker run --rm ghcr.io/flare-foundation/fast-updates/go-client:latest keygen
    ```

    This will generate an output of the form:

    ```json
    {
      "PublicKeyX": "0x14ce9f57394f6dcdba82816808deb5f9c0fd9e5621edeeef35ff1e55346c4ccf",
      "PublicKeyY": "0x131b26a181c5a1f1281f7bd8c745dabb44c5986bb408f88052b336390fcaec51",
      "PrivateKey": "0x0f795088442f405031f54fb6e2f19ea05dc7769755cc28a947df99f6c4b5af22"
    }
    ```

2.  Register public key:

    - If you used the **Automated Registration** script on a testnet (Method 1 above), this step is already completed, skip to [Register validator node](#register-validator-node).
    - If you used **Manual Registration** (Method 2) or need to register manually:

      1. Create a signature proving your `Identity` address owns the generated sortition private key. Use the `keygen` command again, providing the `PrivateKey` (from Step 1) and your `Identity` address.

         ```bash
         # Replace placeholders with your actual values
         docker run --rm ghcr.io/flare-foundation/fast-updates/go-client:latest keygen \
           --key <YOUR_GENERATED_SORTITION_PrivateKey> \
           --address <YOUR_IDENTITY_ADDRESS>
         ```

         This will generate a signature of the form:

         ```plaintext
         Signature generated: 0x10b0f6b68acf899944ce9406c807f38e904401dcf962d7fdd9943b0dee0222321f6863ed9f46d048695942793f1c16158b9a886b6ff2120390f5ddcbbdb0d3b02d8fff2c8f0583c8269650f97a169f5c5ea04ce3bdd91ca959188ac2cf2ff517
         ```

      2. Call the [`registerPublicKey`](/network/fsp/solidity-reference/IEntityManager#registerpublickey) method from your `Identity` address. Provide the `PublicKeyX`, `PublicKeyY` (from Step 1), and the `Signature` (from Step 2a) as arguments.

         ```solidity
         registerPublicKey(
           bytes32 _part1, // <-- REPLACE WITH YOUR GENERATED PublicKeyX
           bytes32 _part2, // <-- REPLACE WITH YOUR GENERATED PublicKeyY
           bytes _verificationData  // <-- REPLACE WITH YOUR GENERATED Signature
         )
         ```

### Register validator node

Link your registered validator node's ID to your Flare Entity `Identity` address via the `EntityManager` contract.

1. Find your active validator node's `staker.key` and `staker.crt` files (Default paths: `~/.avalanchego/staking/`).

2. Prepare shell variables for the file paths and your `Identity` address (without the `0x` prefix).

   ```bash
   PATH_TO_CRT=~/.avalanchego/staking/staker.crt
   ZERO_PREFIX=0000000000000000000000000000000000000000000000000000000000000000
   PATH_TO_KEY=~/.avalanchego/staking/staker.key
   IDENTITY_ADDRESS=ab...123 # <-- REPLACE WITH YOUR IDENTITY ADDRESS WITHOUT 0x prefix
   ```

3. Generate hex values, use the following commands to generate the required contract arguments from your validator files and identity address.

   `_nodeId` (NodeID derived from certificate):

   ```bash
   cat $PATH_TO_CRT | tail -n +2 | head -n -1 | base64 -d | openssl dgst -sha256 -binary | openssl rmd160 -provider legacy -binary | xxd -p | sed -e 's/^/0x/;'
   ```

   `_certificateRaw` (Raw certificate bytes):

   ```bash
   cat $PATH_TO_CRT | tail -n +2 | head -n -1 | base64 -d | xxd -p | tr -d '\n' | sed -e 's/^/0x/;' && echo
   ```

   `_signature` (Signature proving Identity owns the validator key):

   ```bash
   echo -n $ZERO_PREFIX$IDENTITY_ADDRESS | xxd -r -p | openssl dgst -sha256 -sign $PATH_TO_KEY | xxd -p | tr -d '\n' | sed -e 's/^/0x/;' && echo
   ```

4. Call the [`registerNodeId`](/network/fsp/solidity-reference/IEntityManager#registernodeid) method on `EntityManager` using your Identity address. Provide the hex values generated in Step 3 as arguments.

   ```solidity
   registerNodeId(
    bytes20 _nodeId, // <-- REPLACE WITH YOUR GENERATED _nodeId
    bytes _certificateRaw, // <-- REPLACE WITH YOUR GENERATED _certificateRaw
    bytes _signature  // <-- REPLACE WITH YOUR GENERATED _signature
   )
   ```

## Setup FDC

With the necessary registrations complete, this section guides you through setting up the Flare Data Connector (FDC) components.
The goal is to run the underlying blockchain nodes (or connect to existing ones) and the associated FDC indexers and verifiers.
These components securely retrieve and verify data from various blockchains for the Flare network.

The FDC handles data differently depending on the source chain type:

- **UTXO-Based Chains** (e.g., Bitcoin, Dogecoin, Ripple): An indexer service syncs with the blockchain, storing relevant data locally. A Verifier API server then exposes this indexed data.
- **EVM Chains** (e.g., Ethereum, Flare, Songbird): The Verifier API server queries an RPC node directly for necessary data.

:::warning[Resource Intensive]

Deploying the full FDC suite, including multiple blockchain full nodes (BTC, DOGE, XRP, ETH, plus Flare/Songbird for EVM verification) and indexers, demands significant hardware resources.
Ensure your system meets these combined requirements (see main [System Requirements](/run-node/system-requirements) and factor in this additional load).

:::

### Required components

The `fdc-suite-deployment` repository provides configurations for deploying the following components:

#### Blockchain node images

| Network  | Blockchain node image                                                                                                                      |
| -------- | ------------------------------------------------------------------------------------------------------------------------------------------ |
| Bitcoin  | [flarefoundation/bitcoin](https://hub.docker.com/r/flarefoundation/bitcoin)                                                                |
| Dogecoin | [flarefoundation/dogecoin](https://hub.docker.com/r/flarefoundation/dogecoin)                                                              |
| Ripple   | [flarefoundation/rippled](https://hub.docker.com/r/flarefoundation/rippled)                                                                |
| Ethereum | [ethereum/client-go](https://hub.docker.com/r/ethereum/client-go) & [prysm](https://docs.prylabs.network/docs/install/install-with-docker) |

#### Indexers and verifiers

| Network | Indexer                                                                                             | Verifier                                                                                          |
| ------- | --------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------- |
| BTC     | [flare-foundation/verifier-utxo-indexer](https://github.com/flare-foundation/verifier-utxo-indexer) | [flare-foundation/verifier-indexer-api](https://github.com/flare-foundation/verifier-indexer-api) |
| DOGE    | [flare-foundation/verifier-utxo-indexer](https://github.com/flare-foundation/verifier-utxo-indexer) | [flare-foundation/verifier-indexer-api](https://github.com/flare-foundation/verifier-indexer-api) |
| XRP     | [flare-foundation/verifier-xrp-indexer](https://github.com/flare-foundation/verifier-xrp-indexer)   | [flare-foundation/verifier-indexer-api](https://github.com/flare-foundation/verifier-indexer-api) |
| EVM     | -                                                                                                   | [flare-foundation/evm-verifier](https://github.com/flare-foundation/evm-verifier)                 |

:::info Flexibility and Dependencies

- EVM Verification: Note that Flare Mainnet and Songbird Canary-Network nodes (see [Run Node guides](/run-node/)) are also implicitly required for EVM verification tasks run by the FDC Client later, but are typically run as part of your core Flare Entity / Validator setup, not within the `fdc-suite-deployment`.
- Using Existing Nodes: You are not required to deploy all listed blockchain node images using this repository. If you operate your own compatible RPC nodes (e.g., for Bitcoin), you can **configure the corresponding Verifier/Indexer `.env` file (detailed below) with your node's RPC URL and credentials** instead of starting the node image provided here.
- Splitting Deployment: While possible to run components across multiple servers, this guide focuses on the single-machine setup provided by the repository, which may be simpler to manage.
- Dependencies: Indexers and Verifiers require access to a synced and operational blockchain node for their respective chain. Ensure node availability before starting dependent services.

:::

### Configuring blockchain nodes

1. Start by cloning the [flare-foundation/fdc-suite-deployment](https://github.com/flare-foundation/fdc-suite-deployment.git) repo:

   ```bash
   git clone https://github.com/flare-foundation/fdc-suite-deployment.git
   cd fdc-suite-deployment
   ```

2. (optional) Build Docker images. Images are typically pulled automatically from GHCR. If manual building is needed:

   ```bash
   # Clone the specific component repo first, then build
   # docker build -t <image-tag> . # replace image tag with tag used in docker-compose.yaml
   ```

3. To configure node authentication, navigate into the specific node's directory (e.g., `nodes-mainnet/btc`) within the cloned repo and generate credentials where required. **Keep generated credentials secure** as they will be needed for the Verifier configuration.

   - **Bitcoin (BTC) / Dogecoin (DOGE):**

     ```bash
     # Example for BTC
     cd nodes-mainnet/btc
     ./generate-password.sh # Follow prompts or use ./rpcauth.py <USER> <PASS>
     # Note the generated username/password/rpcauth string for later use
     cd ../.. # Return to fdc-suite-deployment root
     ```

     _(Repeat for `nodes-mainnet/doge` if needed)_

   - **Ripple (XRP):** No specific authentication setup needed via this repo's config.
   - **Ethereum (ETH):** Generate JWT secret for communication between Execution (Geth) and Consensus (Prysm) clients:

     ```bash
     # Ensure you are in the fdc-suite-deployment root directory
     openssl rand -hex 32 > nodes-mainnet/eth/jwt.hex
     ```

:::warning[Default Port Exposure]

The default `docker-compose.yaml` files provided in `fdc-suite-deployment` for blockchain nodes might expose standard RPC ports. Review the `ports` section in the relevant `docker-compose.yaml` files and adjust firewall rules on your host machine accordingly to restrict access based on your security policy.

:::

### Configuring indexers and verifiers

Configuration for the indexer and verifier services is managed centrally via the `.env` file in the root of the `fdc-suite-deployment` repository.

1.  Create and Edit `.env`:

    ```bash
    cp .env.example .env
    ```

    Now, carefully edit the `.env` file, providing correct values for all variables relevant to the FDC components you are deploying. Pay close attention to:

    - **RPC Node Connection Details (`*_URL`, `*_RPC_USERNAME`, `*_RPC_PASSWORD` / `*_RPC_AUTH`)**: Provide the full URL and credentials for connecting to each required blockchain node.

      - If using nodes deployed via `fdc-suite-deployment` on the _same host_, you can often use `172.17.0.1` (Docker's default bridge IP) as the hostname in the URL (e.g., `http://admin:<PASSWORD>@172.17.0.1:8332/` for BTC, using the password generated earlier).
      - If using _external_ nodes (your own or third-party), use their publicly accessible RPC endpoint URL and associated credentials.

    - **Start Block Number (`*_START_BLOCK_NUMBER`)**: Crucial for the first run only. Set this for each UTXO indexer (BTC, DOGE, XRP) to a block number finalized approximately **14 days prior** to the current date. (Tip: Use a blockchain explorer for the respective chain to find a block number from around that time). This limits initial indexing duration. **Do not change this value on subsequent restarts** unless intentionally resetting the indexer database; the indexer will automatically resume.
    - **Testnet Mode (`TESTNET`):** Set to `true` if deploying for Coston/Coston2, otherwise `false` (or omit).
    - **Verifier API Keys (`VERIFIER_API_KEYS`)**: Set one or more comma-separated **secret keys**. These keys grant access to your verifier API servers and will be needed by the FDC Client (in the main Flare Entity deployment). Generate strong, unique keys.
    - **Database Passwords (`*_DB_PASSWORD`)**: Set secure, random passwords for the internal indexer databases.

2.  After saving your `.env` file, run the provided script. This injects your `.env` values into the configuration templates used by the individual services.

    ```bash
    ./generate-config.sh
    ```

    _(This populates files in `verifiers/`, `evm-verifier/`, etc.)_

### Start FDC Services

**Important Order:** Start the required blockchain nodes **before** starting their corresponding indexers and verifiers. Ensure nodes are running and ideally synced (or making good progress) first.

#### Start blockchain nodes

1. Go to the directory for the specific blockchain node, e.g., `nodes-mainnet/btc`.

2. Start the node:

   ```bash
   docker compose up -d
   ```

_Repeat for each blockchain node image you are deploying._

#### Start indexers and verifiers

1. Go to the appropriate verifier directory, e.g., `verifiers/btc`.

2. Start the verifier:

   ```bash
   docker compose up -d
   ```

_Repeat for all verifiers corresponding to the chains you need._

:::tip[Verify FDC Services & Initial Indexing]

After starting the FDC nodes, indexers, and verifiers, check their status using `docker ps`.

Review initial logs via `docker compose logs <service_name>` (e.g., `docker compose logs btc-indexer` in the `verifiers/btc` directory) to confirm startup without immediate errors.

:::

## Setup FTSO

To participate in the Flare Time Series Oracle (FTSO), you need a Feed Value Provider service. This section details its requirements and provides steps for testing.

### Feed value provider

:::warning

The example implementation of Feed Value Provider is **only provided for testing purposes and should not be relied on**.
Data providers are expected to reimplement this with their own data sources, following the [required endpoints](#required-endpoints).

:::

Start your own feed value provider, or **(for testing only)** use [flare-foundation/ftso-v2-example-value-provider](https://github.com/flare-foundation/ftso-v2-example-value-provider):

```bash
docker run --rm -it --publish "0.0.0.0:3101:3101" ghcr.io/flare-foundation/ftso-v2-example-value-provider
```

Once the container is running, you can find the API spec at: [`http://localhost:3101/api-doc`](http://localhost:3101/api-doc).

:::info[Troubleshooting]

For initial testing a fixed value provider can be used that simply returns a constant instead of reading data from external data sources. It can be started by setting the variable `VALUE_PROVIDER_IMPL=fixed`.

```bash
docker run --rm -it --env VALUE_PROVIDER_IMPL=fixed --publish "0.0.0.0:3101:3101" ghcr.io/flare-foundation/ftso-v2-example-value-provider
```

You should see the following line in the logs:

```plaintext
WARN [FixedFeed] Initializing FixedFeed, will return 0.01 for all feeds.
```

:::

#### Required endpoints

- **`POST /feed-values`**

  - **Description**: Returns the feed values without specifying the voting round, used by FTSOv2 Fast Updates client.
  - **Request Body**: JSON object containing the feed values.
  - **Example request:**
    ```bash
    curl -X 'POST' 'http://localhost:3101/feed-values/' \
      -H 'accept: application/json' \
      -H 'Content-Type: application/json' \
      -d '{"feeds": [{ "category": 1, "name" : "BTC/USD" }]}'
    ```
  - **Example response:**
    ```json
    {
      "data": [
        {
          "feed": { "category": 1, "name": "BTC/USD" },
          "value": 71285.74004472858
        }
      ]
    }
    ```

- **`POST /feed-values/:votingRoundId`**

  - **Description**: Returns the feed values for the specified voting round, used by FTSOv2 Scaling client.
  - **Response**: JSON object containing the voting round ID and feed values.
  - **Example request:**
    ```bash
    curl -X 'POST' 'http://localhost:3101/feed-values/0' \
      -H 'accept: application/json' \
      -H 'Content-Type: application/json' \
      -d '{"feeds": [{ "category": 1, "name" : "BTC/USD" }]}'
    ```
  - **Example response:**
    ```json
    {
      "votingRoundId": 0,
      "data": [
        {
          "feed": { "category": 1, "name": "BTC/USD" },
          "value": 71287.34508311428
        }
      ]
    }
    ```

<details>
<summary>Remove specific exchanges from the example value provider.</summary>

If you want to remove specific exchanges from the example value provider, you can do so by modifying `src/config/feeds.json`:

Example removing Binance and Bybit exchanges with `jq`:

```bash
curl -fs -o feeds.json https://raw.githubusercontent.com/flare-foundation/ftso-v2-example-value-provider/refs/heads/main/src/config/feeds.json && \
  cp feeds.json feeds.json.bak && \
  jq 'map(.sources |= map(select(.exchange | ascii_downcase != "binance" and ascii_downcase != "bybit")))' feeds.json > feeds.clean && \
  mv feeds.clean feeds.json
```

</details>

### Create Fast Updates accounts

Create **at least three** accounts for submitting FTSOv2 Fast Updates prices.
These can be any accounts **not used** for the five accounts in [FSP addresses](#register-fsp-addresses).
Note down the private keys of these accounts, as they will be used later.

## Run Flare Entity

Now that all prerequisites are met, registrations are complete, and the FDC/FTSO components are configured, you can deploy the main Flare Entity system using the `flare-systems-deployment` repository.

1. Clone [flare-systems-deployment](https://github.com/flare-foundation/flare-systems-deployment) repository:

   ```bash
   git clone https://github.com/flare-foundation/flare-systems-deployment.git
   cd flare-systems-deployment
   ```

2. Copy the sample configuration file:

   ```bash
   cp .env.example .env
   ```

3. Fill out all the values using the information from [Registration](#registration), [Setup FDC](#setup-fdc) and [Setup FTSO](#setup-ftso), the main variables to set are:

   - `NODE_RPC_URL` and (optional) `NODE_API_KEY`: Your RPC Node or a [private RPC provider](/network/developer-tools#rpcs).
   - `IDENTITY`: Public `Identity` address from [FSP addresses](#register-fsp-addresses).
   - `SUBMIT_PK`, `SIGNATURES_PK`, `SIGNING_PK`: Private keys from [FSP addresses](#register-fsp-addresses).
   - `VALUE_PROVIDER_URL`: URL of the [feed value provider](#feed-value-provider).
   - `FAST_UPDATES_ACCOUNTS`: Private keys of the [Fast Updates accounts](#create-fast-updates-accounts).
   - `FAST_UPDATES_SORTITION_PRIVATE_KEY`: Private key of the [sortition key](#register-sortition-key).
   - `<NETWORK>_<ATTESTATION_TYPE>_URL`: URLs of the FDC [verifiers](#start-indexers-and-verifiers) for each network and attestation type. For example, `BTC_PAYMENT_URL` for Bitcoin Payment attestations.
   - (optional) `<NETWORK>_<ATTESTATION_TYPE>_API_KEY`: API keys for the FDC [verifiers](#start-indexers-and-verifiers) for each network and attestation type.

4. Generate the required configurations, you will need to rerun this command if you change your `.env` file:

   ```bash
   ./populate_config.sh
   ```

5. Deploy the instance with the provided `docker-compose.yaml`

   ```bash
   docker compose up -d
   ```

:::tip[Verify Deployment]

Once the deployment is up (`docker ps` should show multiple containers running), monitor the logs of the key components (like `system-client`, `c-chain-indexer`, `fast-updates-client`, `ftso-client`, `fdc-client`) using `docker compose logs <service_name>` to ensure they are connecting, registering (if applicable for the epoch), and starting their processes correctly.

Refer to the [Troubleshooting](#troubleshooting) and [Maintenance](#maintenance) sections for common issues and checks.

:::

## Update Flare Entity

To update the Flare Entity, you can use the `docker compose pull` command to pull the latest image and then restart the services:

```bash
docker compose pull
docker compose up -d
```

This will ensure that you are running the latest version of the Flare Entity components.
If you have made changes to the `.env` file, remember to run `./populate_config.sh` again before restarting the services.

## Troubleshooting

:::tip[Get listed on explorers]

To get your validator logo and name listed on the explorers, open a PR on [TowoLabs/ftso-signal-providers](https://github.com/TowoLabs/ftso-signal-providers).

:::

- **`system-client` is not doing anything**

  Likely, your entity is not registered as a voter for the current reward epoch. There is a time window for voter registration on every reward epoch, and if you leave things running you should eventually see `RegisterVoter success` in the logs. It should then start submitting data successfully in the **following** reward epoch.

- **`system-client` fails to fetch sub-protocol data**

  The `c-chain-indexer` may still be indexing data, once it's finished you should see `Indexer at block x` in the logs. If it's still processing blocks you will see various errors across all services.

- **`fast-updates` client is not doing anything**

  If you have low weight it may take some time until you are selected to submit an update.

- **Icon and logo don't show up on Flare explorers**

  To get your validator logo and name listed on the explorers, open a PR on [TowoLabs/ftso-signal-providers](https://github.com/TowoLabs/ftso-signal-providers).

## Maintenance

- **Basic health checks**:

  - Monitor the `/ext/health` endpoint for validator status
  - Check validator connectivity using this [API endpoint](https://build.avax.network/docs/api-reference/p-chain/api#platformgetcurrentvalidators) to verify uptime/connected values
  - For advanced monitoring, use Avalanche's [Grafana dashboards](https://support.avax.network/en/articles/6159074-grafana-dashboards) which are compatible with Flare

- **FDC health monitoring**:

  - Query each FDC verifier with: `GET http://{verifier-host}:{verifier-port}/verifier/{chain}/health`

- **FTSO health monitoring**:

  - Check minimal conditions status with:

    ```bash
    curl -s 'https://flare-systems-explorer.flare.network/backend-url/api/v0/entity?limit=100&offset=0&sort_ascending=true&sort_by=' | jq '.results[] | select(.identity_address == "YOUR_IDENTITY_ADDRESS") | .entityminimalconditions'
    ```

  - For registration, your log should contain:

    ```plaintext
    [01-03|23:02:03.175] INFO epoch/registry_utils.go:187 Voter 0x25f42DEf3fCc078DE8895Cd01de8AB6514020548 registered for epoch 3589
    [01-04|05:02:04.096] INFO epoch/registry_utils.go:187 Voter 0x25f42DEf3fCc078DE8895Cd01de8AB6514020548 registered for epoch 3590
    [01-04|11:02:07.113] INFO epoch/registry_utils.go:187 Voter 0x25f42DEf3fCc078DE8895Cd01de8AB6514020548 registered for epoch 3591
    [01-04|17:02:03.136] INFO epoch/registry_utils.go:187 Voter 0x25f42DEf3fCc078DE8895Cd01de8AB6514020548 registered for epoch 3592
    [01-04|23:02:03.217] INFO epoch/registry_utils.go:187 Voter 0x25f42DEf3fCc078DE8895Cd01de8AB6514020548 registered for epoch 3593
    ```

  - For submissions, your log should contain:

    ```plaintext
    [01-06|14:39:10.366] INFO protocol/submitter.go:76 Submitter submitSignatures successfully sent tx
    [01-06|14:39:31.273] INFO protocol/submitter.go:76 Submitter submit1 successfully sent tx
    [01-06|14:39:53.107] INFO protocol/submitter.go:76 Submitter submit2 successfully sent tx
    ```

    :::tip[Set an alert]

    Set an alert if there is no `Submitter ... successfully sent tx` message for 5-10 minutes

    :::

  - For finalization verification, your log should contain:

    ```plaintext
    [01-05|15:55:54.641] INFO finalizer/relay_client.go:168 Relaying finished for protocol 100 with success
    [01-05|15:55:55.686] INFO finalizer/relay_client.go:168 Relaying finished for protocol 200 with success
    [01-05|15:57:25.608] INFO finalizer/relay_client.go:168 Relaying finished for protocol 100 with non fatal error
    [01-05|15:57:28.937] INFO finalizer/relay_client.go:168 Relaying finished for protocol 200 with non fatal error
    ```

    :::tip[Set an alert]

    Set an alert if there is no `Relaying finished for protocol ...` for 5-10 minutes (protocol 100 is FTSOv2 and protocol 200 is FDC)

    :::
